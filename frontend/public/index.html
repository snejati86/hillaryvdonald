<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
    <meta charset="UTF-8">
    <title>Hillary vs Donald</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,100,500' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="styles.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="reconnecting-websocket.min.js"/>

    <!-- Latest compiled JavaScript -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="raphael.js"></script>
    <script src="emoji.js"></script>
    <script src="jquery.usmap.js"></script>

    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
    <script type="text/javascript" src="gauge.js"></script>
</head>

<body style="background-color: black">
<div id="map" style="position:absolute; margin-left:7%; opacity:0.4;width: 100%; height: 100%"></div>
<div id="clicked-state" style="z-index: 0"></div>
<div class="row" style="z-index: 1">
    <div id="hillary-column" class="col-sm-5 text-center">
        <div class="inner-column">
            <div class="center-block row image-holder">
                <div class="image-left col-sm-3">
                    <p>Jabs per day: 0</p>
                    <p>Fucks per minute: 0</p>
                    <p>Average length of comments: 0</p>

                </div>
                <div class="image-middle col-sm-6">
                    <img class="center-block" src="hillary.png"/>
                </div>
                <div class="image-right col-sm-3">
                    <p>Mentions: 0</p>
                    <p>In Articles Today : 0</p>
                </div>
            </div>
            <div class="tweet-house">
                <p class="tweet-holder" id="hillary-tweet"></p>
            </div>
            <div class="emoji-container row text-center">
                <h4>Emoji stream</h4>
                <div class="emoji-row text-center">
                    <p class="hillary-numbers">.</p>
                </div>
            </div>
            <div class="social-beat text-center row">
                <span id="hilaryGaugeContainer"></span>
                <span id="hilary2GaugeContainer"></span>
            </div>
            <div class="curse row">
                <table class="table font-apply">
                    <thead class="thead-inverse">
                    <tr>
                        <th style="color:white;text-align:center">Curse stream</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <th class="hi1" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="hi2" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="hi3" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="hi4" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="hi5" style="color:white;text-align:center"></th>
                    </tr>
                    </tbody>
                </table>

            </div>

        </div>


    </div>
    <div id="middle-column" class="col-sm-2 text-center" style="opacity: 0.6">

        <h3 style="color: white">Systems live</h3>
        <img class="twitter-logo" src="twitter-icon.png"><br>
        <img src="reddit-icon.png" class="reddit-logo"><br>
    </div>
    <div id="donald-column" class="col-sm-5 text-center">


        <div class="inner-column">
            <div class="center-block row image-holder">
                <div class="image-left col-sm-3">
                    <p>Jabs per day: 0</p>
                    <p>Fucks per minute: 0</p>
                    <p>Average length of comments: 0</p>

                </div>
                <div class="image-middle col-sm-6">
                    <img class="center-block" src="trump.png"/>
                </div>
                <div class="image-right col-sm-3">
                    <p>Mentions: 0</p>
                    <p>In Articles Today : 0</p>
                </div>
            </div>            <div class="tweet-house">
                <p class="tweet-holder" id="donald-tweet"></p>
            </div>
            <div class="emoji-container row text-center">
                <h4>Emoji stream</h4>
                <div class="emoji-row text-center">
                    <p class="donald-numbers">.</p>
                </div>
            </div>
            <div class="social-beat text-center row">
                <span id="donaldGaugeContainer"></span>
                <span id="donald2GaugeContainer"></span>
            </div>
            <div class="curse row">
                <table class="table font-apply">
                    <thead class="thead-inverse">
                    <tr>
                        <th style="color:white;text-align:center">Curse Stream</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <th class="d1" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="d2" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="d3" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="d4" style="color:white;text-align:center"></th>
                    </tr>
                    <tr>
                        <th class="d5" style="color:white;text-align:center"></th>
                    </tr>
                    </tbody>
                </table>

            </div>

        </div>


    </div>

    <!--<div id="donald-column" class="col-sm-5 text-center">-->
        <!--<img class="center-block" src="trump.png">-->
        <!--<h1 class="donald-numbers" style="font-size:3vw;color: white">Emoji stream</h1>-->
        <!--<span id="donaldGaugeContainer"></span>-->
        <!--<span id="donald2GaugeContainer"></span>-->


        <!--<table class="table">-->
            <!--<thead class="thead-inverse">-->
            <!--<tr>-->
                <!--<th style="color:white;text-align:center">Latest Profanities Used</th>-->
            <!--</tr>-->
            <!--</thead>-->
            <!--<tbody>-->
            <!--<tr>-->
                <!--<th class="d1" style="color:white;text-align:center"></th>-->
            <!--</tr>-->
            <!--<tr>-->
                <!--<th class="d2" style="color:white;text-align:center"></th>-->
            <!--</tr>-->
            <!--<tr>-->
                <!--<th class="d3" style="color:white;text-align:center"></th>-->
            <!--</tr>-->
            <!--<tr>-->
                <!--<th class="d4" style="color:white;text-align:center"></th>-->
            <!--</tr>-->
            <!--<tr>-->
                <!--<th class="d5" style="color:white;text-align:center"></th>-->
            <!--</tr>-->
            <!--</tbody>-->
        <!--</table>-->
    <!--</div>-->
</div>
<script>
    $(document).ready(function () {
        $('#map').usmap({
            stateStyles: {fill: '#919191'},
            stateHoverStyles: {fill: '#75FF59'}
        });
        console.log('ready')


        var gauges = [];

        function createGauge(name, label, min, max) {
            var config =
            {
                size: 120,
                label: label,
                min: undefined != min ? min : 0,
                max: undefined != max ? max : 100,
                minorTicks: 5
            }

            var range = config.max - config.min;
            config.yellowZones = [{from: config.min + range * 0.75, to: config.min + range * 0.9}];
            config.redZones = [{from: config.min + range * 0.9, to: config.max}];

            gauges[name] = new Gauge(name + "GaugeContainer", config);
            gauges[name].render();
        }

        function createGauges() {
            createGauge("donald", "Anger");
            createGauge("donald2", "Joy");

            createGauge("hilary", "Anger");
            createGauge("hilary2", "Joy");

            //setInterval(updateGauges, 500);

        }

        var interval;

        function updateGauges2(msg) {
            clearInterval(interval);
            gauges["donald"].redraw(msg.trump.anger);
            gauges["donald2"].redraw(msg.trump.joy);
            gauges["hilary"].redraw(msg.hillary.anger);
            gauges["hilary2"].redraw(msg.hillary.joy);
            interval = setInterval(function () {
                getRandomValue(msg)
            }, 350);


        }

        function getRandBinary() {
            return (Math.floor(Math.random() * 9) % 2);
        }

//        function updateGauges(msg)
//        {
//            for (var key in gauges)
//            {
//                var value = getRandomValue(gauges[key])
//                gauges[key].redraw(value);
//            }
//        }

        function getRandomValue(msg) {
            if (getRandBinary() == 1) {
                gauges["donald"].redraw(msg.trump.anger + 2);
                gauges["donald2"].redraw(msg.trump.joy + 2);
                gauges["hilary"].redraw(msg.hillary.anger + 2);
                gauges["hilary2"].redraw(msg.hillary.joy + 2);
            }
            else {
                gauges["donald"].redraw(msg.trump.anger - 2);
                gauges["donald2"].redraw(msg.trump.joy - 2);
                gauges["hilary"].redraw(msg.hillary.anger - 2);
                gauges["hilary2"].redraw(msg.hillary.joy - 2);
            }

        }

        createGauges();


        var hillaryNext = 0;
        var trumpNext = 0;
        //var socket = new ReconnectingWebSocket("ws://104.196.26.2:80", null, {debug: false, reconnectInterval: 3000});
        var socket = new ReconnectingWebSocket("ws://localhost:8001", null, {debug: false, reconnectInterval: 3000});
        socket.addEventListener('message', function (msg) {
            var data = JSON.parse(msg.data);
            if (data.topic === 'tweet' || data.topic === 'reddit') {

                var logo;
                //DECIDE LOGo.
                if (data.topic === 'tweet') {
                    logo = $(".twitter-logo");
                } else {
                    logo = $(".reddit-logo");
                }
                flash(logo);

                if (data.topic === 'tweet') {
                    var el;
                    if (data.body.toLowerCase().indexOf('@realdonaldtrump') === -1) {
                        el = $("#hillary-tweet");
                    } else {
                        el = $("#donald-tweet");
                    }
                    displayTweet(data.body, el);


                }


                if (data.loc !== undefined) {
                    $('#map').usmap('trigger', data.loc, "mouseover", data);
                    setTimeout(function () {
                        $('#map').usmap('trigger', data.loc, "mouseout");

                    }, 600);

                }
            }
            else if (data.topic === 'curse') {
                var profanityEnv = data.body;
                if (profanityEnv.Toward === "Hillary") {
                    hillaryNext++;
                    $(".hi" + hillaryNext)[0].innerHTML = profanityEnv.Words;
                    if (hillaryNext === 5) {
                        hillaryNext = 0;
                    }
                }
                else {
                    trumpNext++;
                    $(".d" + trumpNext)[0].innerHTML = profanityEnv.Words;
                    if (trumpNext === 5) {
                        trumpNext = 0;
                    }
                }
            }
            else if (data.topic === 'emoji') {
                var emojiEnv = data.body;
                emojiEnv.owner === "trump" ? field = $(".donald-numbers") : field = $(".hillary-numbers");
                appendEmoji(emojiEnv.emojis, field);

            }
            else if (data.topic === 'feelings') {
                updateGauges2(data.body);
            }


        })
    });


</script>
</body>


</html>